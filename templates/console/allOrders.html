<!DOCTYPE html>
<html>
  {{ template "head.html" }}
  <body>
    {{ template "sidebar" .Sidebar }}

    <div class="content">
      <header>
        {{ template "sidebarButton" }}
        {{ template "logoutButton" }}
      </header>

      <main class="max-w-screen-md">
        <h2>
          Tutti gli ordini
        </h2>

        <div hx-get="/console/allOrdersView" hx-trigger="load" hx-target="this">
        </div>

        <h2>
          Seleziona ordini
        </h2>

        <script>
          function updateCount() {
            const keyStart = 'orderSelection.start';
            const keyEnd = 'orderSelection.end';
            const keySupplier = 'orderSelection.supplier';
            
            const start = document.getElementById(keyStart).value;
            const end = document.getElementById(keyEnd).value;
            const supplier = document.getElementById(keySupplier).value;

            fetch(`/console/orderSelectionCount?${keyStart}=${start}&${keyEnd}=${end}&${keySupplier}=${supplier}`)
              .then(response => response.text())
              .then(count => {
                document.getElementById('count').textContent = count;
              });
          }

          document.addEventListener('DOMContentLoaded', () => {
            updateCount();
          });
        </script>

        <form class="card" method="post" action="/console/orderSelection/" onchange="updateCount()">
          <div class="flex sm:flex-row flex-col gap-4">
            <div class="w-full">{{ template "input" .StartDateInput }}</div>
            <div class="w-full">{{ template "input" .EndDateInput }}</div>  
          </div>
          
          {{ template "select" .SupplierSelect }}
          
          <div class="flex items-center gap-2 pt-4">
            <p class="text-on-surface-dim">
              <span id="count">0</span> ordini selezionati
            </p>
            <button type="submit" class="ml-auto btn-md" name="list">
              <i class="fa-list fas"></i>
              Scarica lista
            </button>
            <button type="submit" class="btn-md suggested" name="csv">
              <i class="fa-table fas"></i>
              Scarica CSV
            </button>
          </div>
        </form>
      </main>
    </div>
  </body>
</html>
