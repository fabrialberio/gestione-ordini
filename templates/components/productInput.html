
{{ define "productInput" }}
<div class="w-full" hx-post="/chef/unitOfMeasureSymbol" hx-target="#unitOfMeasure" hx-trigger="change, load">
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      button = document.getElementById("productSearchButton")
      dialog = document.getElementById("productSearchDialog"),

      dialog.addEventListener("click" , function(event) {
        if (event.target === dialog) {
          dialog.close()
        }
      })
    })

    function onOptionClicked(option) {
      button.innerHTML = option.parentElement.innerText
      dialog.close()
    }
  </script>
  <label>Prodotto</label>
  <div id="productSearchButton" class="flex items-center px-3 input selectable" onclick="dialog.showModal()">
  </div>
  <dialog id="productSearchDialog">
    <!-- TODO: Weird double vertical scroll when page it too short -->
    <div class="space-y-2">
      <input id="productSearchInput" name="{{ .SearchInputName }}" type="search"
      placeholder="Cerca prodotti..."
      autofocus
      hx-post="{{ .ProductSearchURL }}"
      hx-trigger="input changed delay:100ms, search, load"
      hx-target="#productSelect">
      <fieldset class="flex-wrap max-w-md chipBox"
      hx-post="{{ .ProductSearchURL }}"
      hx-trigger="change"
      hx-target="#productSelect">
        {{ range .ProductTypes }}
        <span onclick="this.querySelector('input').click()">
          <input type="checkbox" value="{{ .ID }}" name="{{ $.ProductTypesName }}">
          <i class="fa-check fas"></i>
          {{ .Name }}
        </span>
        {{ end }}
      </fieldset>
    </div>
    <fieldset id="productSelect" class="max-h-[30rem] selectList">
    </fieldset>
  </dialog>
</div>
{{ end }}

{{ define "productSearchResult" }}
<span onclick="this.querySelector('input').click()" class="btn">
  <input type="radio" class="sr-only"
  name="{{ .ProductSelectName }}"
  value="{{ .Product.ID }}"
  onclick="onOptionClicked(this)"
  {{ if .IsSelected }} checked{{ end }}>
  {{ .Product.Name }}
</span>
{{ end }}

{{ define "productSearchNoResults" }}
<span class="p-2 w-full text-center text-on-surface-dim italic">
  Nessun risultato
</span>
{{ end }}
